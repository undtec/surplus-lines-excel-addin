/*! For license information please see functions.js.LICENSE.txt */
(()=>{var e={713(e){function t(){var e,n,a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",i=a.toStringTag||"@@toStringTag";function c(t,a,o,i){var c=a&&a.prototype instanceof u?a:u,f=Object.create(c.prototype);return r(f,"_invoke",function(t,r,a){var o,i,c,u=0,f=a||[],p=!1,l={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,r){return o=t,i=0,c=e,l.n=r,s}};function m(t,r){for(i=t,c=r,n=0;!p&&u&&!a&&n<f.length;n++){var a,o=f[n],m=l.p,g=o[2];t>3?(a=g===r)&&(c=o[(i=o[4])?5:(i=3,3)],o[4]=o[5]=e):o[0]<=m&&((a=t<2&&m<o[1])?(i=0,l.v=r,l.n=o[1]):m<g&&(a=t<3||o[0]>r||r>g)&&(o[4]=t,o[5]=r,l.n=g,i=0))}if(a||t>1)return s;throw p=!0,r}return function(a,f,g){if(u>1)throw TypeError("Generator is already running");for(p&&1===f&&m(f,g),i=f,c=g;(n=i<2?e:c)||!p;){o||(i?i<3?(i>1&&(l.n=-1),m(i,c)):l.n=c:l.v=c);try{if(u=2,o){if(i||(a="next"),n=o[a]){if(!(n=n.call(o,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,i<2&&(i=0)}else 1===i&&(n=o.return)&&n.call(o),i<2&&(c=TypeError("The iterator does not provide a '"+a+"' method"),i=1);o=e}else if((n=(p=l.n<0)?c:t.call(r,l))!==s)break}catch(t){o=e,i=1,c=t}finally{u=1}}return{value:n,done:p}}}(t,o,i),!0),f}var s={};function u(){}function f(){}function p(){}n=Object.getPrototypeOf;var l=[][o]?n(n([][o]())):(r(n={},o,function(){return this}),n),m=p.prototype=u.prototype=Object.create(l);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,r(e,i,"GeneratorFunction")),e.prototype=Object.create(m),e}return f.prototype=p,r(m,"constructor",p),r(p,"constructor",f),f.displayName="GeneratorFunction",r(p,i,"GeneratorFunction"),r(m),r(m,i,"Generator"),r(m,o,function(){return this}),r(m,"toString",function(){return"[object Generator]"}),(t=function(){return{w:c,m:g}})()}function r(e,t,n,a){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}r=function(e,t,n,a){function i(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},r(e,t,n,a)}function n(e,t,r,n,a,o,i){try{var c=e[o](i),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,a)}function a(e){return function(){var t=this,r=arguments;return new Promise(function(a,o){var i=e.apply(t,r);function c(e){n(i,a,o,c,s,"next",e)}function s(e){n(i,a,o,c,s,"throw",e)}c(void 0)})}}var o="https://api.surpluslinesapi.com/v1";function i(){if("undefined"!=typeof Office&&Office.context&&Office.context.roamingSettings){var e=Office.context.roamingSettings.get("sltax_api_key");if(e)return e}if("undefined"!=typeof localStorage){var t=localStorage.getItem("sltax_api_key");if(t)return t}return null}function c(e,t,r,n){return s.apply(this,arguments)}function s(){return(s=a(t().m(function e(r,n,a,o){var c,s,f,l,m,g,y;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r&&""!==r){e.n=1;break}return e.a(2,[['ERROR: Calculation Type is required (use "Tax" or "Rate")']]);case 1:if("tax"===(c=r.toString().trim().toLowerCase())||"rate"===c){e.n=2;break}return e.a(2,[['ERROR: Calculation Type must be "Tax" or "Rate"']]);case 2:if(s=i()){e.n=3;break}return e.a(2,[["ERROR: Please configure your API key in Settings"]]);case 3:if(a&&""!==a){e.n=4;break}return e.a(2,[["ERROR: State Code is required"]]);case 4:if(""===(f=n&&""!==n?n.toString().trim():"")){e.n=5;break}if(l=f,"number"==typeof f&&(m=new Date(1899,11,30),g=new Date(m.getTime()+864e5*f),l=g.toISOString().split("T")[0]),/^\d{4}-\d{2}-\d{2}$/.test(l)){e.n=5;break}return e.a(2,[["ERROR: Date must be in YYYY-MM-DD format or empty string"]]);case 5:if(e.p=5,"tax"!==c){e.n=7;break}return e.n=6,u(s,a,o,f);case 6:case 8:return e.a(2,e.v);case 7:return e.n=8,p(s,a,f);case 9:e.n=11;break;case 10:return e.p=10,y=e.v,e.a(2,[["ERROR: ".concat(y.message)]]);case 11:return e.a(2)}},e,null,[[5,10]])}))).apply(this,arguments)}function u(e,t,r,n){return f.apply(this,arguments)}function f(){return(f=a(t().m(function e(r,n,a,i){var c,s,u,f,p,l,m,g,y,v,h;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(a&&!(a<=0)){e.n=1;break}return e.a(2,[["ERROR: Premium must be greater than 0"]]);case 1:return c={state:n.toString().trim(),premium:parseFloat(a)},i&&""!==i&&(c.effective_date=i),e.p=2,e.n=3,fetch("".concat(o,"/calculate"),{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":r},body:JSON.stringify(c)});case 3:return f=e.v,e.n=4,f.json();case 4:if(p=e.v,f.ok&&p.success){e.n=5;break}throw l=p.error||p.message||"API error: ".concat(f.status),new Error(l);case 5:return m=p.breakdown||{},g=(null===(s=m.base_tax)||void 0===s?void 0:s.amount)||0,y=(null===(u=m.stamping_fee)||void 0===u?void 0:u.amount)||0,v=[["Base Tax",g],["Stamping Fee",y]],p.fallback_reason&&(v.push(["⚠️ Notice",p.fallback_reason]),v.push(["Rates From",p.rates_from||"current"])),e.a(2,v);case 6:throw e.p=6,h=e.v,new Error(h.message);case 7:return e.a(2)}},e,null,[[2,6]])}))).apply(this,arguments)}function p(e,t,r){return l.apply(this,arguments)}function l(){return(l=a(t().m(function e(r,n,a){var i,c,s,u,f,p,l;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return i="".concat(o,"/historical-rates?state=").concat(encodeURIComponent(n.toString().trim())),a&&""!==a&&(i+="&date=".concat(encodeURIComponent(a))),e.p=1,e.n=2,fetch(i,{method:"GET",headers:{"X-API-Key":r}});case 2:return c=e.v,e.n=3,c.json();case 3:if(s=e.v,c.ok&&s.success){e.n=4;break}throw u=s.error||s.message||"API error: ".concat(c.status),new Error(u);case 4:return f=s.rate||{},p=[["tax_rate",f.tax_rate||""],["stamping_fee",f.stamping_fee||""],["filing_fee",f.filing_fee||""],["service_fee",f.service_fee||""],["surcharge",f.surcharge||""],["regulatory_fee",f.regulatory_fee||""],["fire_marshal_tax",f.fire_marshal_tax||""],["slas_clearinghouse_fee",f.slas_clearinghouse_fee||""],["flat_fee",f.flat_fee||""]],s.fallback_reason&&(p.push(["⚠️ Notice",s.fallback_reason]),p.push(["Rates From",s.rates_from||"current"])),e.a(2,p);case 5:throw e.p=5,l=e.v,new Error(l.message);case 6:return e.a(2)}},e,null,[[1,5]])}))).apply(this,arguments)}"undefined"!=typeof CustomFunctions&&CustomFunctions.associate("SLAPI",c),e.exports&&(e.exports={slapi:c,getApiKey:i,setApiKey:function(e){"undefined"!=typeof Office&&Office.context&&Office.context.roamingSettings&&(Office.context.roamingSettings.set("sltax_api_key",e),Office.context.roamingSettings.saveAsync()),"undefined"!=typeof localStorage&&localStorage.setItem("sltax_api_key",e)}})}},t={};!function r(n){var a=t[n];if(void 0!==a)return a.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}(713)})();